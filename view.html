<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>JsonTree</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="d3.v3.min.js"></script>
    <script>
    try {
        var setting = JSON.parse(localStorage['JsonTreeSetting']),
            data = JSON.parse(localStorage['JsonTree']);
        var color = ['#ecda54', '#f1a66a', '#9ed768', '#65d8c5', '#7da5e8'];
        var area = {
            width: setting.width,
            height: setting.height,
            padding: 150
        };

        var tree = d3.layout.tree()
             .size([area.height - area.padding * 2, area.width - area.padding * 2])
             .separation(function(a, b) { return (a.parent == b.parent ? 1 : 2) / a.depth; });

        var diagonal = d3.svg.diagonal()
            .projection(function(d) { return [d.y, d.x]; });

        var svg = d3.select("body").append("svg")
            .attr("width", area.width)
            .attr("height", area.height)
            .append("g")
            .attr("transform", "translate(" + area.padding + ", " + area.padding + ")");

        var nodes = tree.nodes(data),
            links = tree.links(nodes);
        var link = svg.selectAll(".link").data(links);

        var linkEnter = link.enter().append("path")
                      .attr("class", "link")
                      .attr("d", diagonal);

        var node = svg.selectAll(".node").data(nodes);

        var nodeEnter = node.enter().append("g")
            .attr("class", "node")
            .attr("transform", function(d) { 
                return "translate(" + d.y + "," + d.x + ")";
            });

        nodeEnter.append("circle")
            .attr("r", function (d) {
                return d.r || 4.5;
            }).style('stroke', function (d) {
                return color[d.depth];
            });

        nodeEnter.append("text")
            .attr("dy", ".1em")
            .text(function(d) { return d.name; })
            .attr("y", function(d) {
                return d.children || d._children ? -20 : 3; 
            }).attr("x", function(d) {
                return d.children || d._children ? 0 : 20; 
            }).attr("text-anchor", function (d) {
                return d.children || d._children ? 'middle' : 'start';
            });
    } catch (e) {

    }
    </script>
</body>
</html>